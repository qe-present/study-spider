import os, subprocess, execjs, pathlib,requests
from shlex import quote
from urllib.parse import quote
import json
from wyy.utils import get_node
csrf_token='41cc3a81b7f9763f65a52a7bcba0cc86'
url='https://music.163.com/weapi/song/enhance/player/url/v1?csrf_token='+csrf_token

ctx=get_node(js_dir='./wyy/js',js_path='main.js')
ming={
    "csrf_token": "41cc3a81b7f9763f65a52a7bcba0cc86",
    "encodeType": "aac",
    "ids":"[28059417]",
    "level":"exhigh"
}
# 3. 调用
params = ctx.call('get_params', ming)['return_value']
data={
    'params': params[0],
    'encSecKey': params[1],
}
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36 Edg/143.0.0.0',
    'Cookie': '_ga=GA1.1.148646821.1749139407; _clck=o57lyd%7C2%7Cfwj%7C0%7C1982; _ga_C6TGHFPQ1H=GS2.1.s1749227982$o2$g0$t1749227985$j57$l0$h0; _iuqxldmzr_=32; _ntes_nnid=2226f392295aadd33a8aed7b1347c28a,1760713239198; _ntes_nuid=2226f392295aadd33a8aed7b1347c28a; NMTID=00OkOjDWlXcCRltpEkDn4Afw2dCM50AAAGZ8q_veQ; WEVNSM=1.0.0; WNMCID=fvumub.1760713240917.01.0; WM_TID=OBzQ8NmuXAJAUEBUVEfHl78cyLu6F19%2F; sDeviceId=YD-ghYIMLWlBs1BRlRUFAaTgv8J2L%2Fvigfc; ntes_utid=tid._.S1G4y5wEPDZAF1VQEEaC174M2e6qzlbc._.0; __snaker__id=kxFVJL6sfZUmJrJC; gdxidpyhxdE=yMrC0MLDt%2B5oqZEI07D3CuTiIG2B05dcpaYCoXY3O%2FWdr%5CiLCwxEcLxoK2ZeHlaAY38%2B44PuPI7bGA5mrn4nsH%2F6mqJgIuHxmg3j83WerOmwcVSZ%5CmSsu8Xl8EEzVCVOTdqEDVJqDHeq%2BwErMGHJ5d0Nn1QulLM8nZ7r3rugeNGbzeyj%3A1760714174856; __csrf=41cc3a81b7f9763f65a52a7bcba0cc86; MUSIC_U=00A698CF4D127101FC50FBB1621097D387AE3FCFE39190C715B49E9DE04BE8656C03DC0FC8AF06FCBC913DE90BE3DDB0E35E372FF50952E55130E724B9369991C10232A643FA04D0A8AC2A084B87B24F50F1F48107A5C74DA82445F4D05E00D9AE568211BB848313193D1E140C0CC4ED5D3DC41279186D5C88EFC2A59F699A02E65C2DC7F4F0B57E97C8E747BDDB3881CE606EADED956A6BA1EE04B2BC461D13186F602840FA69F2F9972F08EE1A1040CCFAEFC2DA12D193F1CEC8C361EB2A575D9888EF5878B4D600A36E84DDB0C613A87F212F942374B6D9286CF9A74DC8AE0B6E570CD8BAC385FA660B31D71CE5D1027F00C6DB19045E2059CCB9C697F910BD9C6F5CB9F7836DFB4F7FBE6FCCA65EB2446A962DF11D758F17A4D1558E646D36DC6D6C18C1C4B123DBCACCB83AA988E7CD09DF68ACC47BCA0356E90678AFDA3140CE59DB83CEBC2C1812F5CC606C8D856610C8C1509F364DA21F77B00A1F671BAD402ED5BBDCC53437EA791DC3325B22458348F590E522139744EC2CC6DA89D1B9ACFE4B2B1E7D18E4701219DDB53BCD8ADD6680002300AA087D7D79B54CB60DBE28537751A0E26C495563DBFE768DD1; __remember_me=true; P_INFO=18283282272|1760713378|1|music|00&99|null&null&null#CN&null#10#0|&0||18283282272; ntes_kaola_ad=1; timing_user_id=time_Ji9wtnnHzj; _nietop_foot=%u6211%u7684%u4E16%u754C%7Cmc.163.com; WM_NI=wkJqhV684MzThbQJhAalcgVYcEKcqo1gaCK2oB0m4JU%2FzfOAjJ9EO6ulw3FixWtoD6kuAMdSy3bphrOOQFes4u8jquL9v2fL37YRSrYoq4kzqXlj0GB2uT%2BG7Rp1nifnaXA%3D; WM_NIKE=9ca17ae2e6ffcda170e2e6eeb1c441a6b5a193d74e91a88fa7c14b928f9aacc66de9e98495ce6b90a6fcb5c72af0fea7c3b92ab5b58692eb5ef6e8fcaef960acbe9fabeb4ba3b4ad88d553a19b8584f465f3b9afa4ca3aad9e008eb74297f1b687ce4baa96f7a6ce3eb7b4b9d4c563bc89bc90c73ea9ab8faee759bbedae91eb7a8d919fa7e879f8abf88bf47f90e7bad3e548f1e997b3d27a9bb1bfd5ea72b388a48bb34d82eebbb5aa4df58ec0d2ed63a6b2afb9c437e2a3; playerid=76470900; JSESSIONID-WYYY=0fUwUXRe0l2kwf1E%2BNnr2eXYEVt9XOtE5kzGNCvdEoXmXlVp425Z0Wrti%2BR6Uksx5O7wf0nehF4Ax%5CYSDSfwp34HeAtP5KftWxjExjs3%5CNe7cDlWrs%5CDq0uwB%2FwMDrIcQlDPNI1PIo1yhJye2XZiKGY2TcqCAP%2BRGQtKA%2Focvj1ClW%2Fb%3A1760880710989',
    'authority':'music.163.com',
    'Content-type':'application/x-www-form-urlencoded',
    'referer':'https://music.163.com/'
}
response = requests.post(url, data=data)
print(response.text)
# res=response.json()
# if res:
#     music_url=res['data'][0]['url']
#     print(music_url)